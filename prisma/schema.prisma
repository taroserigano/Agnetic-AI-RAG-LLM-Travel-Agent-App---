generator client {
  provider = "prisma-client-js"
}
datasource db {
  provider = "postgresql"
  url = env("DATABASE_URL")
  relationMode = "prisma"
}



model Tour {
  id String @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  userId String
  city String
  country String
  title String
  description String @db.Text
  image String? @db.Text
  stops Json
  tags Json? @default("[]")
  duration String? @default("custom")
  isFeatured Boolean @default(false)
  metadata Json?
  
  @@index([userId])
  @@index([city, country])
}

model Token {
  clerkId String @id
  tokens Int @default (1000)
}

enum KnowledgeStatus {
  PROCESSING
  PROCESSED
  FAILED
}

model KnowledgeDocument {
  id            String          @id @default(uuid())
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  userId        String
  title         String
  filename      String
  filePath      String?          // Path to the stored file on the backend
  mimeType      String
  size          Int
  chunkCount    Int             @default(0)
  tokenEstimate Int             @default(0)
  status        KnowledgeStatus @default(PROCESSING)
  error         String?
  notes         String?
  sourceUrl     String?
  
  chatSessions  ChatSession[]

  @@index([userId])
}

model ChatSession {
  id          String   @id @default(uuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  userId      String
  title       String   @default("New Chat")
  messages    Json     // Array of {role, content, citations}
  
  documents   KnowledgeDocument[]

  @@index([userId])
  @@index([createdAt])
}